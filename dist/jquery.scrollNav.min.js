/*! Scrollnav - v2.0.0 - 2013-10-07
* http://scrollnav.com
* Copyright (c) 2013 James Wilson; Licensed MIT */
!function(a){a.fn.scrollNav=function(b){var c,d,e,f,g=a.extend({sections:"h2",subSections:!1,showHeadline:!0,headlineText:"Scroll To",showTopLink:!0,topLinkText:"Top",fixedMargin:40,scrollOffset:40,animated:!0,speed:500,location:"insertBefore",arrowKeys:!1},b),h=[],i=[],j=[],k=this,l=a("<span />",{"class":"scroll-nav__heading",text:g.headlineText}),m=a("<div />",{"class":"scroll-nav__wrapper"}),n=a("<nav />",{"class":"scroll-nav",role:"navigation"}),o=function(){return window.location.hash},p=function(){a("body").addClass("sn-loading")},q=function(b){b?a("body").removeClass("sn-loading").addClass("sn-active"):a("body").removeClass("sn-loading").addClass("sn-failed")},r=function(){if(g.showTopLink){var b=k.children().first();b.is(g.sections)||h.push(b.nextUntil(g.sections).andSelf())}k.find(g.sections).each(function(){h.push(a(this).nextUntil(g.sections).andSelf())})},s=function(){a(h).each(function(b){var c=[],d=a(this),e="scrollNav-"+(b+1),f=d.offset().top,h=function(){return 0===b},j=function(){return!d.eq(0).is(g.sections)},k=g.showTopLink&&h()&&j()?g.topLinkText:d.filter(g.sections).text();if(g.subSections){var l=d.filter(g.subSections);l.length>0&&(l.each(function(b){var f=e+"-"+(b+1),g=a(this).offset().top,h=a(this).text(),i=d.filter(a(this).nextUntil(l).andSelf());i.wrapAll('<div id="'+f+'" class="scroll-nav__sub-section" />'),c.push({id:f,offset:g,text:h})}),d=a(this).nextUntil(g.sections).andSelf())}d.wrapAll('<section id="'+e+'" />'),i.push({id:e,offset:f,text:k,subSections:c})})},t=function(){var b=a("<ol />",{"class":"scroll-nav__list"});a.each(i,function(c){var d,e=0===c?a("<li />",{"class":"scroll-nav__item active"}):a("<li />",{"class":"scroll-nav__item"}),f=a("<a />",{href:"#"+this.id,"class":"scroll-nav__link",text:this.text});this.subSections.length>0&&(e.addClass("is-parent-item"),d=a("<ol />",{"class":"scroll-nav__sub-list"}),a.each(this.subSections,function(){var b=a("<li />",{"class":"scroll-nav__sub-item"}),c=a("<a />",{href:"#"+this.id,"class":"scroll-nav__sub-link",text:this.text});d.append(b.append(c))})),b.append(e.append(f).append(d))}),g.showHeadline?n.append(m.append(l).append(b)):n.append(m.append(b))},u=function(){n[g.location](k)},v=function(){c=a(window).height(),d=n.offset().top,a.each(i,function(){var b=a("#"+this.id),c=b.height();this.topOffset=b.offset().top,this.bottomOffset=this.topOffset+c})},w=function(){var b=a(window).scrollTop();e=b+g.scrollOffset,f=b+c-g.scrollOffset,j.length=0,b>d-g.fixedMargin?n.addClass("fixed"):n.removeClass("fixed"),a.each(i,function(){(this.topOffset>e&&this.topOffset<f||this.bottomOffset>e&&this.bottomOffset<f||this.topOffset<e&&this.bottomOffset>f)&&j.push(this)}),n.find(".scroll-nav__item").removeClass("active"),a.each(j,function(){n.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("active")})},x=function(){a(window).resize(function(){v(),w()}),a(window).scroll(function(){w()})},y=function(b){var c=a(b).offset().top,d=g.animated?g.speed:0;a("html:not(:animated),body:not(:animated)").animate({scrollTop:c-g.scrollOffset},d)},z=function(){a(".scroll-nav").find("a").click(function(b){b.preventDefault(),y(a(this).attr("href"))})},A=function(){g.arrowKeys&&a(document).keydown(function(a){if(40===a.keyCode||38===a.keyCode){var b=function(a){var b=0,c=i.length;for(b;c>b;b++)if(i[b].id===j[0].id){var d=40===a?b+1:b-1,e=void 0===i[d]?void 0:i[d].id;return e}},c=b(a.keyCode);void 0!==c&&(a.preventDefault(),y("#"+c))}})},B=function(b){if(b){var c=a(b).offset().top;(e>c||c>f)&&y(b)}};return k.length>0?(p(),r(),k.find(g.sections).length>0?(s(),t(),u(),v(),w(),x(),z(),A(),q(!0),B(o())):(console.log('Build failed, scrollNav could not find any "'+g.sections+'s" inside of "'+k.selector+'"'),q(!1))):(console.log('Build failed, scrollNav could not find "'+k.selector+'"'),q(!1)),this}}(jQuery);