/*! Scrollnav - v2.0.0 - 2013-10-05
* http://scrollnav.com
* Copyright (c) 2013 James Wilson; Licensed MIT */
!function(a){a.fn.scrollNav=function(b){var c,d,e=a.extend({sections:"h2",subSections:!1,showHeadline:!0,headlineText:"Scroll To",showTopLink:!0,topLinkText:"Top",fixedMargin:40,scrollOffset:40,animated:!0,speed:500,location:"insertBefore"},b),f=[],g=[],h=this,i=a("<span />",{"class":"scroll-nav__heading",text:e.headlineText}),j=a("<div />",{"class":"scroll-nav__wrapper"}),k=a("<nav />",{"class":"scroll-nav",role:"navigation"}),l=function(){a("body").addClass("sn-loading")},m=function(b){b?a("body").removeClass("sn-loading").addClass("sn-active"):a("body").removeClass("sn-loading").addClass("sn-failed")},n=function(){if(e.showTopLink){var b=h.children().first();b.is("h2")||f.push(b.nextUntil(e.sections).andSelf())}h.find(e.sections).each(function(){f.push(a(this).nextUntil(e.sections).andSelf())})},o=function(){a(f).each(function(b){var c=[],d=a(this),f="scrollNav-"+(b+1),h=d.offset().top,i=function(){return 0===b},j=function(){return!d.eq(0).is("h2")},k=e.showTopLink&&i(b)&&j()?e.topLinkText:d.filter(e.sections).text();if(e.subSections){var l=d.filter(e.subSections);l.length>0&&(l.each(function(b){var e=f+"-"+(b+1),g=a(this).offset().top,h=a(this).text(),i=d.filter(a(this).nextUntil(l).andSelf());i.wrapAll('<div id="'+e+'" class="scroll-nav__sub-section" />'),c.push({id:e,offset:g,text:h})}),d=a(this).nextUntil(e.sections).andSelf())}d.wrapAll('<section id="'+f+'" />'),g.push({id:f,offset:h,text:k,subSections:c})})},p=function(){var b=a("<ol />",{"class":"scroll-nav__list"});a.each(g,function(c){var d,e=0===c?a("<li />",{"class":"scroll-nav__item active"}):a("<li />",{"class":"scroll-nav__item"}),f=a("<a />",{href:"#"+this.id,"class":"scroll-nav__link",text:this.text});this.subSections.length>0&&(e.addClass("is-parent-item"),d=a("<ol />",{"class":"scroll-nav__sub-list"}),a.each(this.subSections,function(){var b=a("<li />",{"class":"scroll-nav__sub-item"}),c=a("<a />",{href:"#"+this.id,"class":"scroll-nav__sub-link",text:this.text});d.append(b.append(c))})),b.append(e.append(f).append(d))}),e.showHeadline?k.append(j.append(i).append(b)):k.append(j.append(b))},q=function(){k[e.location](h)},r=function(){c=a(window).height(),d=k.offset().top,a.each(g,function(){var b=a("#"+this.id),c=b.height();this.topOffset=b.offset().top,this.bottomOffset=this.topOffset+c})},s=function(){var b=a(window).scrollTop(),f=b+e.scrollOffset,h=b+c-e.scrollOffset,i=[];b>d-e.fixedMargin?k.addClass("fixed"):k.removeClass("fixed"),a.each(g,function(){(this.topOffset>f&&this.topOffset<h||this.bottomOffset>f&&this.bottomOffset<h||this.topOffset<f&&this.bottomOffset>h)&&i.push(this)}),k.find(".scroll-nav__item").removeClass("active"),a.each(i,function(){k.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("active")})},t=function(){a(window).resize(function(){r(),s()}),a(window).scroll(function(){s()})},u=function(){e.animated&&a(".scroll-nav").find("a").click(function(b){b.preventDefault();var c=a(this).attr("href"),d=a(c).offset().top;a("html:not(:animated),body:not(:animated)").animate({scrollTop:d-e.scrollOffset},e.speed)})};return h.length>0?(l(),n(),h.find(e.sections).length>0?(o(),p(),q(),r(),s(),t(),u(),m(!0)):(console.log('Build failed, scrollNav could not find any "'+e.sections+'s" inside of "'+h.selector+'"'),m(!1))):(console.log('Build failed, scrollNav could not find "'+h.selector+'"'),m(!1)),this}}(jQuery);