/*! scrollNav - v2.0.1 - 2013-10-31
* http://scrollnav.com
* Copyright (c) 2013 James Wilson; Licensed MIT */
(function(t){t.fn.scrollNav=function(s){var n,e,i,o,l=t.extend({sections:"h2",subSections:!1,sectionElem:"section",showHeadline:!0,headlineText:"Scroll To",showTopLink:!0,topLinkText:"Top",fixedMargin:40,scrollOffset:40,animated:!0,speed:500,insertTarget:this.selector,insertLocation:"insertBefore",arrowKeys:!1},s),a=[],c=[],f=[],r=this,d=t(l.insertTarget),h=t("<span />",{"class":"scroll-nav__heading",text:l.headlineText}),u=t("<div />",{"class":"scroll-nav__wrapper"}),v=t("<nav />",{"class":"scroll-nav",role:"navigation"}),p=function(){return window.location.hash},_=function(){t("body").addClass("sn-loading")},m=function(s){s?t("body").removeClass("sn-loading").addClass("sn-active"):t("body").removeClass("sn-loading").addClass("sn-failed")},g=function(){if(l.showTopLink){var s=r.children().first();s.is(l.sections)||a.push(s.nextUntil(l.sections).andSelf())}r.find(l.sections).each(function(){a.push(t(this).nextUntil(l.sections).andSelf())})},w=function(){t(a).each(function(s){var n=[],e=t(this),i="scrollNav-"+(s+1),o=e.offset().top,a=function(){return 0===s},f=function(){return!e.eq(0).is(l.sections)},r=l.showTopLink&&a()&&f()?l.topLinkText:e.filter(l.sections).text();if(l.subSections){var d=e.filter(l.subSections);d.length>0&&(d.each(function(s){var o=i+"-"+(s+1),l=t(this).offset().top,a=t(this).text(),c=e.filter(t(this).nextUntil(d).andSelf());c.wrapAll('<div id="'+o+'" class="scroll-nav__sub-section" />'),n.push({id:o,offset:l,text:a})}),e=t(this).nextUntil(l.sections).andSelf())}e.wrapAll("<"+l.sectionElem+' id="'+i+'" class="scroll-nav__section" />'),c.push({id:i,offset:o,text:r,subSections:n})})},x=function(){var s=t("<ol />",{"class":"scroll-nav__list"});t.each(c,function(n){var e,i=0===n?t("<li />",{"class":"scroll-nav__item active"}):t("<li />",{"class":"scroll-nav__item"}),o=t("<a />",{href:"#"+this.id,"class":"scroll-nav__link",text:this.text});this.subSections.length>0&&(i.addClass("is-parent-item"),e=t("<ol />",{"class":"scroll-nav__sub-list"}),t.each(this.subSections,function(){var s=t("<li />",{"class":"scroll-nav__sub-item"}),n=t("<a />",{href:"#"+this.id,"class":"scroll-nav__sub-link",text:this.text});e.append(s.append(n))})),s.append(i.append(o).append(e))}),l.showHeadline?v.append(u.append(h).append(s)):v.append(u.append(s))},b=function(){v[l.insertLocation](d)},C=function(){n=t(window).height(),e=v.offset().top,t.each(c,function(){var s=t("#"+this.id),n=s.height();this.topOffset=s.offset().top,this.bottomOffset=this.topOffset+n})},T=function(){var s=t(window).scrollTop();i=s+l.scrollOffset,o=s+n-l.scrollOffset,f.length=0,s>e-l.fixedMargin?v.addClass("fixed"):v.removeClass("fixed"),t.each(c,function(){(this.topOffset>i&&o>this.topOffset||this.bottomOffset>i&&o>this.bottomOffset||i>this.topOffset&&this.bottomOffset>o)&&f.push(this)}),v.find(".scroll-nav__item").removeClass("active").removeClass("in-view"),t.each(f,function(t){0===t?v.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("active").addClass("in-view"):v.find('a[href="#'+this.id+'"]').parents(".scroll-nav__item").addClass("in-view"),t++})},O=function(){t(window).resize(function(){C(),T()}),t(window).scroll(function(){T()})},k=function(s){if(t(s).length>0){var n=t(s).offset().top,e=l.animated?l.speed:0;t("html:not(:animated),body:not(:animated)").animate({scrollTop:n-l.scrollOffset},e)}},y=function(){t(".scroll-nav").find("a").click(function(s){s.preventDefault(),k(t(this).attr("href"))})},S=function(){l.arrowKeys&&t(document).keydown(function(t){if(40===t.keyCode||38===t.keyCode){var s=function(t){var s=0,n=c.length;for(s;n>s;s++)if(c[s].id===f[0].id){var e=40===t?s+1:s-1,i=void 0===c[e]?void 0:c[e].id;return i}},n=s(t.keyCode);void 0!==n&&(t.preventDefault(),k("#"+n))}})},L=function(s){if(s&&t(s).length>0){var n=t(s).offset().top;(i>n||n>o)&&k(s)}};return r.length>0?(_(),g(),r.find(l.sections).length>0?(w(),x(),d.length>0?(b(),C(),T(),O(),y(),S(),m(!0),L(p())):(console.log('Build failed, scrollNav could not find "'+l.insertTarget+'"'),m(!1))):(console.log('Build failed, scrollNav could not find any "'+l.sections+'s" inside of "'+r.selector+'"'),m(!1))):(console.log('Build failed, scrollNav could not find "'+r.selector+'"'),m(!1)),this}})(jQuery);